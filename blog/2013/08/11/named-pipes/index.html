
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Named Pipes - Written by Thorsten Ball</title>
  <meta name="author" content="Thorsten Ball">

  
  <meta name="description" content="A lot of people know and love Unix pipes, myself included, since they let you do
stuff like this: cat access.log | awk '{print $9}' | sort | uniq -c &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://mrnugget.github.com/blog/2013/08/11/named-pipes/">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="/javascripts/ender.js"></script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <link href="/atom.xml" rel="alternate" title="Written by Thorsten Ball" type="application/atom+xml">
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-32543112-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body    class="collapse-sidebar sidebar-footer" >
  <header role="banner"><hgroup>
  <h1><a href="/">Written by Thorsten Ball</a></h1>
  
</hgroup>

</header>
  <nav role="navigation">  
<ul class="main-navigation">
  <li><a href="/">Home</a></li>
  <li><a href="/blog/archives">Posts</a></li>
  <li><a href="http://www.github.com/mrnugget">Github</a></li>
  <li><a href="http://www.twitter.com/thorstenball">Twitter</a></li>
</ul>
<ul class="subscription">
  <li><a href="/atom.xml" alt="Subscribe to the RSS feed">RSS</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">Named Pipes</h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-08-11T16:41:00+02:00" pubdate data-updated="true">Aug 11<span>th</span>, 2013</time>
        
         | <a href="#disqus_thread">Comments</a>
        
      </p>
    
  </header>


<div class="entry-content"><p>A lot of people know and love Unix pipes, myself included, since they let you do
stuff like this: <code>cat access.log | awk '{print $9}' | sort | uniq -c</code>. What a
lot of people don&#8217;t know are <a href="http://en.wikipedia.org/wiki/Named_pipe">Named Pipes</a>,
which are pretty interesting and worth knowing about.</p>

<!-- more -->


<p>In contrast to &#8220;unnamed pipes&#8221; (<code>|</code>) a named pipe has a file name on your file
system and can be accessed by independent processes that were not spawned by the
same parent process. To create a named pipe use <a href="http://linux.die.net/man/1/mkfifo">mkfifo(1)</a>:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>mkfifo my_named_pipe
</span><span class='line'><span class="nv">$ </span>ls -l
</span><span class='line'>total 0
</span><span class='line'>prw-r--r--  1 mrnugget  staff  0 Aug 11 16:59 my_named_pipe
</span></code></pre></td></tr></table></div></figure>


<p>The <code>p</code> in the left column of the <code>ls -l</code> output indicates that <code>my_named_pipe</code>
is a pipe. You can change the permission bits as with any other file.</p>

<p>Using it is straightforward, just write something to it in one process and read
from it in another. In the first shell:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>cat access.log | awk <span class="s1">&#39;{print $9}&#39;</span> &gt; my_named_pipe
</span></code></pre></td></tr></table></div></figure>


<p>As you can see, this will block until another process reads from the pipe. So
open up another shell and read from it:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>sort my_named_pipe | uniq -c
</span></code></pre></td></tr></table></div></figure>


<p>The first process will exit when it&#8217;s done writing and sends EOF. The second
process stops when it sees the EOF and exits.</p>

<p>Even if you have never used a named pipe that&#8217;s been created with <code>mkfifo(1)</code>,
you might have used one without knowing about it, since shells (at least Bash
and ZSH) use named pipes whenever they encounter command substitution:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>diff &lt;<span class="o">(</span>ls ./old/<span class="o">)</span> &lt;<span class="o">(</span>ls ./new/<span class="o">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>The shell will spawn two subshells here, running <code>ls ./old/</code> and <code>ls ./new/</code>
respectively, redirecting their output to two named pipe it creates and names.
It then passes the name of the pipes to <code>diff(1)</code>, which expects filenames as
arguments.</p>

<h2>Communication Between Processes</h2>

<p>What else can we do with named pipes? Since they can be read from and written to
by independent processes, we can use them for communicating between them. Of
course, we can write to and read text from them, yes. But since writing or
reading from the named pipes will block until the other end is doing
something, we can use that behaviour for means of communication.</p>

<p>Imagine one process waiting for another process to finish. Set up a named pipe
and have it read from it:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>mkfifo /tmp/finished
</span><span class='line'><span class="nv">$ </span>cat /tmp/finished <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">&quot;The other process is finished! Yay! Let&#39;s do some work!&quot;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Now whenever you want to signal this process that it can stop waiting, just
write something to the pipe:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>./doing_a_lot_of_work_here <span class="o">&amp;&amp;</span> <span class="o">(</span><span class="nb">echo</span> <span class="s1">&#39;I am done here.&#39;</span> &gt; /tmp/finished<span class="o">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>This reminds me of using dedicated quit channels in Golang to signal other
goroutines when to quit. The cool thing about this is that multiple
processes can wait on one process. Or multiple processes can write to the
named pipe and just one is reading.</p>

<h2>Sharing Terminal Output With <code>script(1)</code>, netcat And Named Pipes</h2>

<p>Let&#8217;s use a named pipe to do a &#8220;terminal screen sharing&#8221; session, by using
<code>script(1)</code>. <code>script(1)</code> allows us to record a shell session by writing a
typescript to a file. We will use a named pipe instead of a file. So open up the
first shell and type in the following:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>mkfifo screenshare
</span><span class='line'><span class="nv">$ </span>script -t 0 screenshare
</span></code></pre></td></tr></table></div></figure>


<p>Again, this will block. So let&#8217;s read from the pipe in another shell:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>cat screenshare
</span></code></pre></td></tr></table></div></figure>


<p>The first shell shouldn&#8217;t block anymore and open a new <code>script(1)</code> session.
Switch to it and type something in, e.g. <code>ls -l</code>. You should now see your first
shell session mirrored in the second one, by the power of <code>script(1)</code> and
<code>mkfifo(1)</code>.</p>

<p>Let&#8217;s take it one step further. Let&#8217;s use netcat (<code>nc(1)</code>) to stream the shell
session over the network! The first thing we need is a listener on one computer:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>nc -l -p 9999
</span></code></pre></td></tr></table></div></figure>


<p>This computer will now wait for connections and data on port 9999. Now we need
a named pipe and <code>script(1)</code> in one shell session just like before:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>mkfifo screenshare
</span><span class='line'><span class="nv">$ </span>script -t 0 screenshare
</span></code></pre></td></tr></table></div></figure>


<p>But instead of using <code>cat(1)</code>, we use <code>nc(1)</code> to send the typescript to our
listener in another shell:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>nc &lt;ip-of-listener&gt; 9999 &lt; screenshare
</span></code></pre></td></tr></table></div></figure>


<p>If you now start working in the shell that ran <code>script(1)</code> a typescript will be
written to the named pipe, which netcat will read from to send it the listener
computer. Of course, this is totally insecure, but it&#8217;s really, really cool
nonetheless, right?</p>

<p>Another cool more practical thing to do is using named pipes to asynchronously
run tests, by writing test commands in on one end and running those commands on
the other end. Gary Bernhardt demonstrated that in a great
<a href="https://www.destroyallsoftware.com/screencasts/catalog/running-tests-asynchronously">screencast</a>.</p>

<p>I have to admit, learning about named pipes is by no means a world changing
event and experience. Mostly because an &#8220;unnamed pipe&#8221; is more often than not
the better and easier way to go. Still, I think it&#8217;s useful to know about and to
understand them. Having named pipes in your tool belt is certainly not something
you will regret.</p>

<h2>Resources</h2>

<ul>
<li><a href="http://www.linuxjournal.com/article/2156?page=0,1">Linuxjournal: Introduction to named pipes</a></li>
<li><a href="http://en.wikipedia.org/wiki/Named_pipe">Wikipedia: Named Pipe</a></li>
<li><a href="http://unix.stackexchange.com/questions/17107/process-substitution-and-pipe">Unix &amp; Linux Stackexchange - Process Subtitution and Pipe</a></li>
<li><a href="http://linux.about.com/od/Bash_Scripting_Solutions/a/Process-Substitution-And-Named-Pipes.htm">About.com - Process Substitution And Named Pipes</a></li>
<li><a href="http://www.tldp.org/LDP/lpg/node15.html">The Linux Documentation Project - Named Pipes</a></li>
</ul>

</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">Thorsten Ball</span></span>

      








  


<time datetime="2013-08-11T16:41:00+02:00" pubdate data-updated="true">Aug 11<span>th</span>, 2013</time>
      


    </p>
    
      <div class="sharing">
  
  <a href="http://twitter.com/share" class="twitter-share-button" data-url="http://mrnugget.github.com/blog/2013/08/11/named-pipes/" data-via="thorstenball" data-counturl="http://mrnugget.github.com/blog/2013/08/11/named-pipes/" >Tweet</a>
  
  
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/blog/2013/04/07/watchgopher/" title="Previous Post: Watchgopher">&laquo; Watchgopher</a>
      
      
    </p>
  </footer>
</article>

  <section>
    <h1>Comments</h1>
    <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
  </section>

</div>

<aside class="sidebar">
  
    <section class="about">
  <h1>About Me</h1>
  <img src="/images/avatar.jpg">
  <p>
    I'm 25 years old, live in Berlin, Germany and love programming, command
    lines, databases, Ruby, Go, JavaScript, Unix, Ruby on Rails and several other
    things having to do with web development.
  </p>
  <p>
    I work for <a href="http://www.coding-robin.de">Coding Robin</a> as a software
    developer.
  </p>
  <p>
    If you want to contact me via e-mail: <a href="http://www.github.com/mrnugget">my github username</a> at gmail.com
  </p>
</section>
<section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2013/08/11/named-pipes/">Named Pipes</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/04/07/watchgopher/">Watchgopher</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/01/15/discipline/">Discipline</a>
      </li>
    
      <li class="post">
        <a href="/blog/2012/10/24/command-line-ride/">Command Line Ride</a>
      </li>
    
      <li class="post">
        <a href="/blog/2012/09/02/software-covers-and-programming-licks/">Software Cover Versions And Programming Licks</a>
      </li>
    
  </ul>
</section>

<section>
  <h1>Latest Tweets</h1>
  <ul id="tweets">
    <li class="loading">Status updating...</li>
  </ul>
  <script type="text/javascript">
    $.domReady(function(){
      getTwitterFeed("thorstenball", 4, false);
    });
  </script>
  <script src="/javascripts/twitter.js" type="text/javascript"> </script>
  
    <a href="http://twitter.com/thorstenball" class="twitter-follow-button" data-show-count="false">Follow @thorstenball</a>
  
</section>


  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2013 - Thorsten Ball
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'writtenbythorstenball';
      
        
        // var disqus_developer = 1;
        var disqus_identifier = 'http://mrnugget.github.com/blog/2013/08/11/named-pipes/';
        var disqus_url = 'http://mrnugget.github.com/blog/2013/08/11/named-pipes/';
        var disqus_script = 'embed.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
